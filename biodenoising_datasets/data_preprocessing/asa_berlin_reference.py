import os
import pandas as pd
from . import download
from .AudioDataset import AudioDataset
'''
This is a public dataset containing the reference set of the Animal Sound Archive at the Museum für Naturkunde Berlin.
The dataset is not directly available for download, but can be downloaded from the ASA website.
For more information check the repository:
Animal Sound Archive at the Museum für Naturkunde Berlin Reference set
https://www.museumfuernaturkunde.berlin/en/science/animal-sound-archive
'''
asa_dict = {
    "Accipiter_gentilis": "Northern Goshawk",
    "Hirundo_rustica": "Barn Swallow",
    "Accipiter_nisus": "Eurasian Sparrowhawk",
    "Hyla_arborea": "European Tree Frog",
    "Acrocephalus_arundinaceus": "Great Reed Warbler",
    "Hyla_meridionalis": "Mediterranean Tree Frog",
    "Acrocephalus_melanopogon": "Moustached Warbler",
    "Ixobrychus_minutus": "Little Bittern",
    "Acrocephalus_paludicola": "Aquatic Warbler",
    "Jynx_torquilla": "Eurasian Wryneck",
    "Acrocephalus_palustris": "Marsh Warbler",
    "Lagopus_muta": "Rock Ptarmigan",
    "Acrocephalus_schoenobaenus": "Sedge Warbler",
    "Lanius_collurio": "Red-backed Shrike",
    "Acrocephalus_scirpaceus": "Eurasian Reed Warbler",
    "Lanius_excubitor": "Great Grey Shrike",
    "Actitis_hypoleucos": "Common Sandpiper",
    "Lanius_minor": "Lesser Grey Shrike",
    "Aegithalos_caudatus": "Long-tailed Tit",
    "Larus_argentatus": "Herring Gull",
    "Aegolius_funereus": "Boreal Owl",
    "Larus_cachinnans": "Caspian Gull",
    "Alauda_arvensis": "Eurasian Skylark",
    "Larus_canus": "Common Gull",
    "Alcedo_atthis": "Common Kingfisher",
    "Larus_fuscus": "Lesser Black-backed Gull",
    "Alectoris_rufa": "Red-legged Partridge",
    "Larus_marinus": "Great Black-backed Gull",
    "Alopochen_aegyptiaca": "Egyptian Goose",
    "Larus_michahellis": "Yellow-legged Gull",
    "Alytes_obstetricans": "Common Midwife Toad",
    "Limosa_limosa": "Black-tailed Godwit",
    "Anas_acuta": "Northern Pintail",
    "Locustella_fluviatilis": "River Warbler",
    "Anas_penelope": "Eurasian Wigeon",
    "Locustella_luscinioides": "Savi's Warbler",
    "Anas_platyrhynchos": "Mallard",
    "Locustella_naevia": "Common Grasshopper Warbler",
    "Anas_querquedula": "Garganey",
    "Lophophanes_cristatus": "Crested Tit",
    "Anas_strepera": "Gadwall",
    "Loxia_curvirostra": "Red Crossbill",
    "Anser_albifrons": "Greater White-fronted Goose",
    "Loxia_leucoptera": "Two-barred Crossbill",
    "Anser_anser": "Greylag Goose",
    "Loxia_pytyopsittacus": "Parrot Crossbill",
    "Anser_fabalis": "Bean Goose",
    "Lullula_arborea": "Woodlark",
    "Anser_serrirostris": "Tundra Bean Goose",
    "Luscinia_luscinia": "Thrush Nightingale",
    "Anthus_campestris": "Tawny Pipit",
    "Luscinia_megarhynchos": "Common Nightingale",
    "Anthus_cervinus": "Red-throated Pipit",
    "Luscinia_svecica": "Bluethroat",
    "Anthus_petrosus": "Rock Pipit",
    "Lyrurus_tetrix": "Black Grouse",
    "Anthus_pratensis": "Meadow Pipit",
    "Martes_foina": "Beech Marten",
    "Anthus_spinoletta": "Water Pipit",
    "Melanocorypha_calandra": "Calandra Lark",
    "Anthus_trivialis": "Tree Pipit",
    "Mergus_serrator": "Red-breasted Merganser",
    "Apus_apus": "Common Swift",
    "Merops_apiaster": "European Bee-eater",
    "Aquila_chrysaetos": "Golden Eagle",
    "Milvus_migrans": "Black Kite",
    "Aquila_pomarina": "Lesser Spotted Eagle",
    "Milvus_milvus": "Red Kite",
    "Ardea_cinerea": "Grey Heron",
    "Monticola_solitarius": "Blue Rock Thrush",
    "Arenaria_interpres": "Ruddy Turnstone",
    "Motacilla_alba": "White Wagtail",
    "Asio_otus": "Long-eared Owl",
    "Motacilla_cinerea": "Grey Wagtail",
    "Athene_noctua": "Little Owl",
    "Motacilla_flava": "Western Yellow Wagtail",
    "Aythya_ferina": "Common Pochard",
    "Muscicapa_striata": "Spotted Flycatcher",
    "Aythya_fuligula": "Tufted Duck",
    "Nucifraga_caryocatactes": "Spotted Nutcracker",
    "Bombina_bombina": "European Fire-bellied Toad",
    "Numenius_arquata": "Eurasian Curlew",
    "Bombina_variegata": "Yellow-bellied Toad",
    "Numenius_phaeopus": "Whimbrel",
    "Botaurus_stellaris": "Eurasian Bittern",
    "Oenanthe_leucura": "Black Wheatear",
    "Branta_canadensis": "Canada Goose",
    "Oenanthe_oenanthe": "Northern Wheatear",
    "Branta_leucopsis": "Barnacle Goose",
    "Oriolus_oriolus": "Eurasian Golden Oriole",
    "Bubo_bubo": "Eurasian Eagle-owl",
    "Otus_scops": "Eurasian Scops Owl",
    "Bubo_scandiacus": "Snowy Owl",
    "Pandion_haliaetus": "Osprey",
    "Bucephala_clangula": "Common Goldeneye",
    "Panurus_biarmicus": "Bearded Reedling",
    "Bufo_bufo": "Common Toad",
    "Parus_major": "Great Tit",
    "Bufo_calamita": "Natterjack Toad",
    "Passer_domesticus": "House Sparrow",
    "Buteo_buteo": "Common Buzzard",
    "Passer_hispaniolensis": "Spanish Sparrow",
    "Calandrella_brachydactyla": "Greater Short-toed Lark",
    "Passer_montanus": "Eurasian Tree Sparrow",
    "Calandrella_rufescens": "Lesser Short-toed Lark",
    "Pelophylax_ridibundus": "Marsh Frog",
    "Calcarius_lapponicus": "Lapland Longspur",
    "Perdix_perdix": "Grey Partridge",
    "Calidris_alpina": "Dunlin",
    "Periparus_ater": "Coal Tit",
    "Calidris_canutus": "Red Knot",
    "Phalacrocorax_carbo": "Great Cormorant",
    "Calidris_ferruginea": "Curlew Sandpiper",
    "Phasianus_colchicus": "Common Pheasant",
    "Capreolus_capreolus": "Roe Deer",
    "Phoenicopterus_roseus": "Greater Flamingo",
    "Caprimulgus_europaeus": "European Nightjar",
    "Phoenicurus_ochruros": "Black Redstart",
    "Carduelis_cannabina": "Common Linnet",
    "Phoenicurus_phoenicurus": "Common Redstart",
    "Carduelis_carduelis": "European Goldfinch",
    "Phylloscopus_bonelli": "Western Bonelli's Warbler",
    "Carduelis_citrinella": "Citril Finch",
    "Phylloscopus_borealis": "Arctic Warbler",
    "Carduelis_flammea": "Common Redpoll",
    "Phylloscopus_canariensis": "Canary Islands Chiffchaff",
    "Carduelis_spinus": "Eurasian Siskin",
    "Phylloscopus_collybita": "Common Chiffchaff",
    "Carpodacus_erythrinus": "Common Rosefinch",
    "Phylloscopus_ibericus": "Iberian Chiffchaff",
    "Certhia_brachydactyla": "Short-toed Treecreeper",
    "Phylloscopus_sibilatrix": "Wood Warbler",
    "Certhia_familiaris": "Eurasian Treecreeper",
    "Phylloscopus_trochiloides": "Greenish Warbler",
    "Strix_nebulosa": "Great Grey Owl",
    "Charadrius_dubius": "Little ringed Plover",
    "Charadrius_alexandrinus": "Kentish Plover",
    "Turdus_philomelos": "Song Thrush",
    "Remiz_pendulinus": "Eurasian Penduline-tit",
    "Tringa_totanus": "Common Redshank",
    "Cuculus_canorus": "Common Cuckoo",
    "Coturnix_coturnix": "Common Quail",
    "Rana_esculenta": "Edible Frog",
    "Gryllus_campestris": "Field Cricket",
    'Hippolais_olivetorum': 'Olive-tree Warbler',
    'Sylvia_undata': 'Dartford Warbler',
    'Columba_palumbus': 'Common Wood Pigeon',
    'Ficedula_albicollis': 'Collared Flycatcher',
    'Streptopelia_turtur': 'European Turtle Dove',
    'Sylvia_nisoria': 'Barred Warbler',
    'Tetrastes_bonasia': 'Hazel Grouse',
    'Cygnus_olor': 'Mute Swan',
    'Rana_temporaria': 'Common Frog',
    'Somateria_mollissima': 'Common Eider',
    'Corvus_corone': 'Carrion Crow',
    'Turdus_iliacus': 'Redwing',
    'Emberiza_calandra': 'Corn Bunting',
    'Cygnus_columbianus': 'Tundra Swan',
    'Circus_aeruginosus': 'Western Marsh Harrier',
    'Tachybaptus_ruficollis': 'Little Grebe',
    'Serinus_serinus': 'European Serin',
    'Galerida_theklae': 'Thekla Lark',
    'Himantopus_himantopus': 'Black-winged Stilt',
    'Sterna_paradisaea': 'Arctic Tern',
    'Tringa_ochropus': 'Green Sandpiper',
    'Corvus_cornix': 'Hooded Crow',
    'Chlidonias_niger': 'Black Tern',
    'Falco_peregrinus': 'Peregrine Falcon',
    'Pyrrhula_pyrrhula': 'Eurasian Bullfinch',
    'Haliaeetus_albicilla': 'White-tailed Eagle',
    'Sylvia_conspicillata': 'Spectacled Warbler',
    'Porzana_parva': 'Little Crake',
    'Dendrocopos_medius': 'Middle Spotted Woodpecker',
    'Falco_tinnunculus': 'Common Kestrel',
    'Sylvia_melanocephala': 'Sardinian Warbler',
    'Falco_subbuteo': 'Eurasian Hobby',
    'Sylvia_curruca': 'Lesser Whitethroat',
    'Prunella_modularis': 'Dunnock',
    'Rallus_aquaticus': 'Water Rail',
    'Porzana_pusilla': 'Baillon’s Crake',
    'Columba_oenas': 'Stock Dove',
    'Recurvirostra_avosetta': 'Pied Avocet',
    'Cisticola_juncidis': 'Zitting Cisticola',
    'Erithacus_rubecula': 'European Robin',
    'Picus_canus': 'Grey-faced Woodpecker',
    'Emberiza_rustica': 'Rustic Bunting',
    'Pica_pica': 'Eurasian Magpie',
    'Dryocopus_martius': 'Black Woodpecker',
    'Poecile_montanus': 'Willow Tit',
    'Sylvia_atricapilla': 'Eurasian Blackcap',
    'Grus_grus': 'Common Crane',
    'Tringa_erythropus': 'Spotted Redshank',
    'Rissa_tridactyla': 'Black-legged Kittiwake',
    'Turdus_viscivorus': 'Mistle Thrush',
    'Garrulus_glandarius': 'Eurasian Jay',
    'Turdus_pilaris': 'Fieldfare',
    'Emberiza_pusilla': 'Little Bunting',
    'Sylvia_cantillans': 'Subalpine Warbler',
    'Clamator_glandarius': 'Great Spotted Cuckoo',
    'Fulica_atra': 'Common Coot',
    'Chloris_chloris': 'European Greenfinch',
    'Corvus_frugilegus': 'Rook',
    'Chlidonias_hybrida': 'Whiskered Tern',
    'Emberiza_schoeniclus': 'Common Reed Bunting',
    'Tringa_glareola': 'Wood Sandpiper',
    'Chroicocephalus_ridibundus': 'Black-headed Gull',
    'Emberiza_cia': 'Rock Bunting',
    'Tetrao_urogallus': 'Western Capercaillie',
    'Podiceps_cristatus': 'Great Crested Grebe',
    'Chlidonias_leucopterus': 'White-winged Tern',
    'Pyrrhocorax_pyrrhocorax': 'Red-billed Chough',
    'Fringilla_montifringilla': 'Brambling',
    'Podiceps_grisegena': 'Red-necked Grebe',
    'Scolopax_rusticola': 'Eurasian Woodcock',
    'Emberiza_hortulana': 'Ortolan Bunting',
    'Coloeus_monedula': 'Eurasian Jackdaw',
    'Eumodicogryllus_bordigalensis': 'Southern Mole Cricket',
    'Emberiza_citrinella': 'Yellowhammer',
    'Saxicola_rubetra': 'Whinchat',
    'Fringilla_coelebs': 'Common Chaffinch',
    'Thalasseus_sandvicensis': 'Sandwich Tern',
    'Pyrrhocorax_graculus': 'Alpine Chough',
    'Charadrius_hiaticula': 'Common Ringed Plover',
    'Plectrophenax_nivalis': 'Snow Bunting',
    'Gallinago_gallinago': 'Common Snipe',
    'Streptopelia_decaocto': 'Eurasian Collared Dove',
    'Podiceps_nigricollis': 'Black-necked Grebe',
    'Regulus_ignicapilla': 'Common Firecrest',
    'Tyto_alba': 'Barn Owl',
    'Troglodytes_troglodytes': 'Eurasian Wren',
    'Cyanistes_caeruleus': 'Eurasian Blue Tit',
    'Gallinula_chloropus': 'Common Moorhen',
    'Turdus_merula': 'Common Blackbird',
    'Haematopus_ostralegus': 'Eurasian Oystercatcher',
    'Phylloscopus_trochilus': 'Willow Warbler',
    'Gryllotalpa_gryllotalpa': 'European Mole Cricket',
    'Emberiza_aureola': 'Yellow-breasted Bunting',
    'Gavia_arctica': 'Black-throated Loon',
    'Tringa_nebularia': 'Common Greenshank',
    'Poecile_palustris': 'Marsh Tit',
    'Corvus_corax': 'Common Raven',
    'Emberiza_melanocephala': 'Black-headed Bunting',
    'Strix_aluco': 'Tawny Owl',
    'Upupa_epops': 'Eurasian Hoopoe',
    'Emberiza_cirlus': 'Cirl Bunting',
    'Crex_crex': 'Corn Crake',
    'Sturnus_vulgaris': 'Common Starling',
    'Ficedula_parva': 'Red-breasted Flycatcher',
    'Vulpes_vulpes': 'Red Fox',
    'Falco_biarmicus': 'Lanner Falcon',
    'Cettia_cetti': 'Cetti’s Warbler',
    'Dendrocopos_major': 'Great Spotted Woodpecker',
    'Sitta_europaea': 'Eurasian Nuthatch',
    'Saxicola_rubicola': 'European Stonechat',
    'Galerida_cristata': 'Crested Lark',
    'Hippolais_icterina': 'Icterine Warbler',
    'Tadorna_tadorna': 'Common Shelduck',
    'Delichon_urbicum': 'Common House Martin',
    'Sylvia_communis': 'Common Whitethroat',
    'Sylvia_borin': 'Garden Warbler',
    'Riparia_riparia': 'Sand Martin',
    'Dendrocopos_minor': 'Lesser Spotted Woodpecker',
    'Picus_viridis': 'European Green Woodpecker',
    'Coccothraustes_coccothraustes': 'Hawfinch',
    'Ficedula_hypoleuca': 'European Pied Flycatcher',
    'Regulus_regulus': 'Goldcrest',
    'Stercorarius_skua': 'Great Skua',
    'Vanellus_vanellus': 'Northern Lapwing',
    'Charadrius_morinellus': 'Eurasian Dotterel',
    'Sterna_hirundo': 'Common Tern',
    'Clangula_hyemalis': 'Long-tailed Duck',
    'Porzana_porzana': 'Spotted Crake',
    'Cygnus_cygnus': 'Whooper Swan'
}

class Dataset(AudioDataset):
    def __init__(self, conf, path, dname='asa_berlin_reference', *args, **kwargs):
        self.path = path
        self.df =  pd.DataFrame(columns=['dirs','medium','caption','caption2','url','source','recordist','species_common','species_scientific','audiocap_id','youtube_id','start_time','species','relative_path'])
        folders = [f for f in os.listdir(os.path.join(self.path, 'ASA_Berlin_reference_database')) if os.path.isdir(os.path.join(self.path, 'ASA_Berlin_reference_database', f))]
        for d in folders:
            files = [f for f in os.listdir(os.path.join(self.path, 'ASA_Berlin_reference_database', d)) if f.endswith('.wav')]
            for f in files:
                caption = asa_dict[d]
                caption2 =  d.replace('_', ' ')
                url= 'https://www.museumfuernaturkunde.berlin/en/science/animal-sound-archive'
                source = 'ASA Berlin Reference'
                recordist = ''
                species_common = asa_dict[d] 
                species_scientific = d.replace('_', ' ')
                audiocap_id = ''
                youtube_id = ''
                start_time = 0
                medium = 'terrestrial'
                species = d.replace('_', ' ')
                relative_path = os.path.join('ASA_Berlin_reference_database',d, f)
                row = {'dirs':'all','medium':medium,'caption':caption, 'caption2':caption2, 'url':url, 'source':source, 'recordist':recordist, 'species_common':species_common, 'species_scientific':species_scientific, 'audiocap_id':audiocap_id, 'youtube_id':youtube_id, 'start_time':start_time, 'species':species, 'relative_path':relative_path}
                self.df.loc[len(self.df)] = row
        self.df.to_csv(os.path.join(self.path, 'metadata.csv'), index=False)
        super(Dataset, self).__init__(conf, path, dname, *args, **kwargs)
        

# Links to the audio files
REMOTES = {
    "archive": download.RemoteFileMetadata(
        filename="ASA_Berlin_reference_database.zip",
        url="gs://asa_berlin/ASA_Berlin_reference_database.zip",
        checksum="2c76b15caa791ef47586cc214bab634d",
    )
}
